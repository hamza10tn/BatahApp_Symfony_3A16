{% extends 'page-shop-cart.html.twig' %}

{% block pane %}
    {% if basketData is empty %}
        <!-- Empty Basket Section -->
        <section class="posts">
            <article class="article1">
                <img class="img1" src="{{ asset('assets/images/emptyBasket.png') }}" alt="" width="250px" class="mt-3 mb-3">
                <h4>Votre panier est vide!</h4>
                <p>Vous n'avez pas encore ajouté d'article à votre panier.</p>
                <a href="{{ path('app_afficahge_produits') }}" class="btn btn-secondary">Retour à l'accueil</a>
            </article>
        </section>
    {% else %}
        <!-- Non-empty Basket Section -->
        <section class="shop-cart bgc-f9 pt0">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8">
                        <div class="shopping_cart_tabs ovyh">
                            <div class="shopping_cart_table">
                                <table class="table table-responsive table-borderless">
                                    <thead class="thead-dark">
                                        <tr>
                                            <th class="pl30" colspan="1" scope="row">Product</th>
                                            <th scope="col">Price</th>
                                            <th scope="col">Quantity</th>
                                            <th scope="col">Subtotal</th>
                                            <th scope="col"></th>
                                        </tr>
                                    </thead>
                                    <tbody class="table_body">
                                        {% for basketItem in basketData %}
                                            <tr>
                                                <td>
                                                    <ul class="cart_list mt20">
                                                        <li class="list-inline-item">
                                                            <a href="#">
                                                                {% if imagesByLocation[basketItem.idProduit.idProduit] is not empty %}
                                                                    {% set firstImage = imagesByLocation[basketItem.idProduit.idProduit][0] %}
                                                                    <img src="{{ asset(firstImage.getUrl()) }}" alt="Product Image">
                                                                {% else %}
                                                                    <img src="{{ asset('uploads/defaultimage.jpg') }}" alt="Default Image">
                                                                {% endif %}
                                                            </a>
                                                        </li>
                                                        <li class="list-inline-item">
                                                            <a class="cart_title" href="#">
                                                                {{ basketItem.idProduit.labelle }}
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </td>
                                                <td>{{ basketItem.idProduit.prix|number_format(0, '.', ',') }} DT</td>
                                                <td>1</td> {# Since quantity is not provided, assuming it's always 1 #}
                                                <td>{{ basketItem.idProduit.prix|number_format(0, '.', ',') }} DT</td> {# Subtotal equals to price for each item #}
                                                <td class="pr25">
                                                    <a href="{{ path('app_removeFromBasket', {'idp': basketItem.idBasket}) }}" data-bs-toggle="tooltip" data-bs-placement="top" title="Delete">
                                                        <span class="flaticon-trash"></span>
                                                    </a>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="order_sidebar_widget style2">
                            <h4 class="title">Cart Totals</h4>
                            <ul class="mb15">
                                <li class="subtitle">
                                    <p>Subtotal <span class="float-end">{{ totalPrice|number_format(0, '.', ',') }} DT</span></p>
                                </li>
                                <!-- Add any other totals you need here -->
                            </ul>
                            <div class="ui_kit_button payment_widget_btn">
                                <a href="{{ path('app_commands') }}" class="btn btn-thm btn-block">Proceed to Checkout</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    {% endif %}
{% endblock %}
